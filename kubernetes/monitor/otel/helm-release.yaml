# yaml-language-server: $schema=../../../schemas/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: splunk-otel-collector
  namespace: monitor
spec:
  interval: 5m
  chart:
    spec:
      chart: splunk-otel-collector
      version: 0.76.0
      interval: 5m
      sourceRef:
        kind: HelmRepository
        name: splunk-otel-collector-chart
        namespace: flux-system
  values:
    clusterName: k3s_homelab
    environment: production
    logsEngine: otel
    splunkPlatform:
      endpoint: https://splunk-hec.${DOMAIN_NAME}/services/collector/event
      index: k8s_events
      metricsEnabled: false
      logsEnabled: true
    logsCollection:
      containers:
        enabled: true
        excludePaths:
          - "/var/log/pods/nginx-internal_logging-nginx-internal-controller*/*/*.log"
          - "/var/log/pods/longhorn-system_longhorn-manager*/*/*.log"
          - "/var/log/pods/downloads-vpn_downloads-gateway-pod-gateway*/*/*.log" # longhorn and vpn generate too many events to make them useful
          - "/var/log/pods/kube-system_snapshot-controller*/*/*.log"
    secret:
      create: false
